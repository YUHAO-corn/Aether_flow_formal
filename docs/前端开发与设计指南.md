# AetherFlow 前端开发与设计指南

## 概述
本文档整合了AetherFlow项目的前端开发准则、界面设计确认记录和设计规范的核心内容，作为我们两人协作开发的参考指南。

## 界面设计确认要求

### 核心要求（2023年3月7日确认）

> "我目前对已有的前端界面已经很满意，不需要重新设计，在没有向我确认前不允许对界面效果进行改动。"

### 具体示例

1. **配色和动效**
   - 确认内容：现有主题的配色和动效已获得认可，不需要修改
   - 状态：已确认，不允许修改

2. **新功能UI组件**
   - 确认内容：新增功能（如注册和登录）需要先询问是否需要添加相应的前端组件
   - 状态：需在实施前获得确认

### 已确认的界面设计

- **浏览器插件界面**：整体布局和导航结构、提示词卡片设计、提示词优化界面设计、自动保存通知设计
- **网页端界面**：整体布局和导航结构、提示词管理界面、资产仪表盘设计、沙盘调试界面设计

## 前端开发准则

### 核心原则

1. **界面设计稳定性原则**
   - 现有界面设计已获得认可，未经明确确认不得修改
   - 包括但不限于：配色方案、动效设计、布局结构、交互模式等
   - 即使有更好的设计方案，也必须先获得确认后才能实施

2. **功能扩展确认原则**
   - 新功能的前端实现必须基于已确认的需求
   - 在添加新的UI组件或页面前，必须获得明确确认
   - 功能扩展应遵循现有的设计语言和交互模式

3. **代码质量优先原则**
   - 保持代码的可读性、可维护性和性能
   - 遵循项目的代码规范和最佳实践
   - 优先修复bug和性能问题，而非改进界面设计

### 界面修改流程简述

1. **修改提议**：记录详细的改进建议，包括当前问题、改进方案、预期提升和复杂度评估
2. **确认阶段**：获得明确的书面确认，包含修改范围和边界
3. **实施阶段**：严格限制在确认的范围内进行修改
4. **验收阶段**：确认修改符合预期且不影响其他功能

### 允许的修改（无需额外确认）

- 修复明显的UI bug（如文本溢出、对齐错误）
- 优化代码实现，在不改变外观和行为的前提下提高性能
- 根据已确认的设计规范调整细节（如统一字体大小、边距等）
- 添加已确认功能所需的新组件（前提是遵循现有设计语言）

### 需要确认的修改

- 更改主题配色方案
- 修改动效设计
- 调整页面布局结构
- 改变交互模式
- 添加新的UI组件或页面
- 更改导航结构
- 调整响应式设计断点

## 设计规范要点

### 色彩系统

- **主色调**
  - 深邃蓝 `#1A1B4B`：背景和主要元素
  - 魔法紫 `#7B2CBF`：强调和重点元素
  - 星尘银 `#E2E2E2`：文字和边框

- **辅助色**
  - 以太蓝 `#4361EE`：交互元素
  - 魔晶绿 `#4CC9A0`：成功和正面反馈
  - 警示红 `#E63946`：警告和错误状态
  - 魔法金 `#FFD700`：稀有和高价值内容

- **渐变色**
  - 魔法能量渐变：`linear-gradient(135deg, #7B2CBF 0%, #4361EE 100%)`
  - 以太流动渐变：`linear-gradient(135deg, #4361EE 0%, #4CC9A0 100%)`
  - 星空背景渐变：`linear-gradient(180deg, #1A1B4B 0%, #0D0D2B 100%)`

### 组件设计要点

- **按钮**：魔法能量渐变背景，悬停时轻微放大并增强发光效果
- **卡片**：深色半透明背景，渐变边框，悬停时轻微上浮
- **输入框**：深色半透明背景，星尘银边框，获焦时变为魔法紫
- **模态窗口**：星空背景，半透明效果，内容区域使用卡片样式
- **导航栏**：深邃蓝背景，当前选中项使用魔法紫高亮和发光效果

### 动效系统要点

- 动效时长控制在300-500ms之间
- 使用缓动函数创造自然流畅的感觉
- 页面切换：淡入淡出结合侧向移动
- 元素出现：轻微缩放结合淡入
- 按钮点击：波纹效果结合轻微收缩

## 组件共享策略要点

### 共享原则

1. **设计一致性原则**：所有共享组件必须遵循统一的设计语言
2. **功能适应性原则**：共享组件应具备适应不同平台特性的能力
3. **性能优化原则**：浏览器插件端更注重轻量化，网页端更注重功能完整性

### 关键共享组件

- **提示词相关组件**：PromptCard、PromptEditor、PromptList、TagSelector等
- **基础组件**：Button、Input、Modal、Tooltip等
- **布局组件**：Container、Grid、Flex等
- **反馈组件**：Toast、Alert、Spinner等

### 平台特定适配

- **浏览器插件适配**：针对侧边栏有限空间优化，减少资源占用
- **网页端适配**：响应式布局，支持更复杂的数据展示

## 已完成的前端组件开发

### 核心组件

1. **PromptLibrary组件**
   - 功能：提示词库展示、搜索、标签筛选、排序、复制和收藏功能
   - 状态：已完成，包含完整测试
   - 特点：
     - 支持按使用次数、收藏状态、创建日期排序
     - 支持标签筛选和关键词搜索
     - 支持复制提示词内容和收藏功能
     - 未认证用户显示登录提示
     - 使用framer-motion实现动画效果

2. **SearchSuggestion组件**
   - 功能：实时搜索提示词，显示搜索结果
   - 状态：已完成，包含完整测试
   - 特点：
     - 支持实时搜索和防抖处理
     - 显示搜索结果和加载状态
     - 支持点击搜索结果插入提示词
     - 未认证用户显示登录提示
     - 使用framer-motion实现动画效果

3. **AutoSave组件**
   - 功能：自动保存用户提示词，显示保存历史
   - 状态：已完成，包含完整测试
   - 特点：
     - 定期检查页面内容并自动保存
     - 显示保存状态和历史记录
     - 支持展开/收起保存历史
     - 使用framer-motion实现动画效果

### API客户端

- 创建axios实例，配置baseURL、超时和请求头
- 实现请求拦截器，自动添加token到请求头
- 实现响应拦截器，处理错误响应和401未授权错误
- 定义API端点，包括认证、提示词、标签和提示词优化相关的接口

### 测试

- 为核心组件编写完整的测试用例
- 模拟API客户端，不依赖msw
- 配置Jest测试环境
- 实现localStorage和navigator.clipboard的模拟

## 下一步开发计划

### 短期计划（1-2周）

1. **Prompt Enhancement组件开发**
   - 实现提示词优化界面
   - 集成提示词优化API
   - 实现优化结果展示，包括动画效果
   - 实现多轮优化功能
   - 编写完整测试用例

2. **完善现有组件**
   - 提高测试覆盖率
   - 优化性能
   - 解决已知的UI一致性问题

### 中期计划（3-4周）

1. **网页端Prompt管理开发**
   - 实现Prompt管理界面
   - 实现卡片展示区
   - 实现搜索和标签筛选
   - 实现排序和筛选功能

2. **资产仪表盘开发**
   - 实现词云图组件
   - 实现雷达图组件
   - 实现热力图组件
   - 实现数据获取和处理

### 长期计划（1-2个月）

1. **沙盘调试功能开发**
   - 实现大模型API调用
   - 实现对话界面
   - 实现对话历史管理
   - 实现提示词测试功能

2. **Suggestion功能开发**
   - 实现系统预设提示词推荐
   - 实现个性化推荐算法
   - 实现推荐展示界面

## 沟通与回顾机制

- 定期回顾本文档，确保对界面设计要求的理解一致
- 任何界面修改建议通过直接沟通提出
- 记录所有确认的修改决定
- 更新本文档以反映最新的确认内容

最后更新时间：2023年11月15日 

## 前端测试实用指南

### 自动化测试与人工测试

自动化测试通过并不意味着功能在实际环境中一定能正常工作。这是因为自动化测试通常在模拟环境中进行，而实际的浏览器环境可能有所不同。

#### 自动化测试通过但人工测试失败的常见原因

1. 测试环境与真实浏览器环境的差异
2. 事件处理和DOM交互在真实环境中更复杂
3. 自动化测试可能没有完全模拟用户交互流程

#### 人工测试前的必要准备

1. **添加关键日志**：
   ```javascript
   // 在关键点添加日志
   console.log('检测到"/"输入', { value: inputField.value });
   console.log('尝试插入文本', { text, success: result });
   ```

2. **验证DOM交互**：
   ```javascript
   // 确认能找到正确的DOM元素
   const textarea = document.querySelector('textarea');
   console.log('找到输入框:', !!textarea, textarea);
   ```

3. **准备调试函数**：
   ```javascript
   // 添加可在控制台调用的测试函数
   window.testPromptImage = function() {
     // 测试下拉菜单显示
     const dropdown = createDropdown();
     console.log('测试下拉菜单:', dropdown);
     
     // 测试文本插入
     const result = insertTextAtCursor('测试文本');
     console.log('测试插入结果:', result);
   };
   ```

#### 常见问题快速解决方案

1. **下拉菜单不显示**：
   - 检查输入框选择器是否正确
   - 确认事件监听器已添加
   - 尝试直接调用创建下拉菜单的函数

2. **选择后不插入文本**：
   - 使用更直接的方法操作输入框
   ```javascript
   // 直接操作输入框值
   textarea.value = textarea.value.replace('/', '替换的文本');
   // 触发input事件
   textarea.dispatchEvent(new Event('input', { bubbles: true }));
   ```

3. **事件处理问题**：
   - 确保阻止默认行为和事件冒泡
   ```javascript
   element.addEventListener('click', (e) => {
     e.preventDefault();
     e.stopPropagation();
     // 处理点击...
   });
   ```

#### PromptImage功能测试案例

**问题**: 选择提示词后未插入到输入框
**原因**: 事件处理不正确或默认行为未阻止
**解决方案**: 
```javascript
// 改进的点击事件处理
item.addEventListener('click', function(e) {
  // 阻止默认行为和事件冒泡
  e.preventDefault();
  e.stopPropagation();
  
  // 直接操作输入框值
  inputField.value = inputField.value.replace('/', this.textContent);
  
  // 触发input事件，确保平台能够检测到输入变化
  const inputEvent = new Event('input', { bubbles: true });
  inputField.dispatchEvent(inputEvent);
  
  // 移除下拉菜单
  if (document.body.contains(dropdown)) {
    document.body.removeChild(dropdown);
  }
  
  // 聚焦回输入框
  inputField.focus();
  
  return false;
});
```

最后更新时间：2025年3月8日 