# AetherFlow 前后端集成方案

## 概述

本文档记录 AetherFlow 项目的前后端集成方案，采用 To-Do List 形式，便于跟踪进度和分工协作。

## 接口需求清单

### 认证模块

- [x] `/auth/register` (POST) - 用户注册
- [x] `/auth/login` (POST) - 用户登录
- [x] `/auth/me` (GET) - 获取当前用户信息
- [x] `/auth/updateMe` (PATCH) - 更新用户信息
- [x] `/auth/logout` (POST) - 用户登出

### 提示词模块

- [ ] `/prompts` (GET) - 获取提示词列表
- [ ] `/prompts` (POST) - 创建提示词
- [ ] `/prompts/auto-save` (POST) - 自动保存提示词
- [ ] `/prompts/batch` (POST) - 批量获取提示词
- [ ] `/prompts/recent` (GET) - 获取最近使用的提示词
- [ ] `/prompts/quick-search` (GET) - 快速搜索提示词
- [ ] `/prompts/enhance` (POST) - 优化提示词
- [ ] `/prompts/:id` (GET) - 获取单个提示词
- [ ] `/prompts/:id` (PATCH) - 更新提示词
- [ ] `/prompts/:id` (DELETE) - 删除提示词
- [ ] `/prompts/:id/favorite` (PATCH) - 切换收藏状态
- [ ] `/prompts/:id/usage` (PATCH) - 增加使用次数

### 标签模块

- [ ] `/tags` (GET) - 获取标签列表
- [ ] `/tags` (POST) - 创建标签
- [ ] `/tags/:id` (GET) - 获取单个标签
- [ ] `/tags/:id` (PATCH) - 更新标签
- [ ] `/tags/:id` (DELETE) - 删除标签
- [ ] `/tags/:id/prompts` (GET) - 获取标签的提示词

### 提示词优化模块

- [ ] `/prompt-optimization/config` (GET) - 获取客户端配置
- [ ] `/prompt-optimization` (POST) - 优化提示词
- [ ] `/prompt-optimization/history` (GET) - 获取优化历史
- [ ] `/prompt-optimization/history/:id` (GET) - 获取单个优化历史
- [ ] `/prompt-optimization/history/:id/rate` (POST) - 评价优化结果
- [ ] `/prompt-optimization/api-keys` (POST) - 管理API密钥
- [ ] `/prompt-optimization/api-keys` (GET) - 获取API密钥
- [ ] `/prompt-optimization/api-keys/:id` (DELETE) - 删除API密钥

### 会话模块

- [ ] `/conversations` (GET) - 获取会话列表
- [ ] `/conversations` (POST) - 创建会话
- [ ] `/conversations/:id` (GET) - 获取单个会话
- [ ] `/conversations/:id` (PATCH) - 更新会话
- [ ] `/conversations/:id` (DELETE) - 删除会话
- [ ] `/conversations/:id/messages` (GET) - 获取会话的消息
- [ ] `/conversations/:id/messages` (POST) - 添加消息到会话
- [ ] `/conversations/:id/messages` (DELETE) - 清空会话消息

### 活动日志模块

- [ ] `/activities` (GET) - 获取用户活动日志
- [ ] `/activities/stats` (GET) - 获取活动统计信息
- [ ] `/activities` (DELETE) - 清除活动日志
- [ ] `/activities/:id` (GET) - 获取单个活动日志

## 前端组件与接口对应关系

### 浏览器插件前端

| 组件 | 需要的接口 |
|------|-----------|
| `App.jsx` | `/auth/me` ✅ |
| `PromptLibrary.jsx` | `/prompts`, `/prompts/batch`, `/prompts/:id`, `/prompts/:id/favorite`, `/prompts/:id/usage`, `/tags` |
| `PromptEnhancement.jsx` | `/prompts/enhance`, `/prompt-optimization`, `/prompt-optimization/history` |
| `SearchSuggestion.jsx` | `/prompts/quick-search`, `/prompts/recent`, `/prompts/:id/usage` |
| `AutoSave.jsx` | `/prompts/auto-save` |
| `Settings.jsx` | `/auth/register` ✅, `/auth/login` ✅, `/auth/updateMe` ✅, `/auth/logout` ✅, `/prompt-optimization/api-keys` |

### 网页前端

| 组件 | 需要的接口 |
|------|-----------|
| `PromptCard.tsx` | `/prompts/:id/favorite`, `/tags` |
| `PromptLaboratory.tsx` | `/prompts`, `/prompt-optimization`, `/conversations`, `/conversations/:id/messages` |
| `AnalyticsDashboard.tsx` | `/activities`, `/activities/stats` |
| `TagNavigation.tsx` | `/tags`, `/tags/:id/prompts` |
| `WordCloud.tsx` | `/activities/stats` |
| `RadarChart.tsx` | `/activities/stats` |

## 集成优先级

### 第一优先级（核心功能）

- [ ] 认证模块全部接口（进行中）
- [ ] 提示词基础功能（列表、创建、获取、更新、删除）
- [ ] 自动保存功能
- [ ] 标签基础功能

### 第二优先级（增强功能）

- [ ] 提示词优化功能
- [ ] 提示词快速搜索
- [ ] 收藏和使用统计功能
- [ ] 会话管理功能

### 第三优先级（分析功能）

- [ ] 活动日志记录和统计
- [ ] 数据可视化相关接口

## 测试要点

- [ ] 认证流程完整性测试（进行中）
- [ ] 提示词CRUD操作测试
- [ ] 标签与提示词关联测试
- [ ] 提示词优化功能测试
- [ ] 会话交互流程测试
- [ ] 数据统计和可视化测试

## 注意事项

1. 前端组件中的模拟数据需要替换为真实API调用
2. 需要实现统一的错误处理机制
3. 需要处理认证失效的情况
4. 需要考虑网络请求的加载状态和错误状态
5. 需要确保API响应格式与前端预期一致

## 已完成功能

### 认证模块（进行中）

1. 创建了API客户端（apiClient.js）✅
   - 实现了请求和响应拦截器
   - 添加了token管理功能
   - 实现了错误处理机制

2. 创建了认证上下文（AuthContext.jsx）✅
   - 实现了用户注册功能
   - 实现了用户登录功能
   - 实现了获取当前用户信息功能
   - 实现了更新用户信息功能
   - 实现了用户登出功能

3. 更新了Settings组件 ✅
   - 添加了登录表单
   - 添加了注册表单
   - 添加了用户信息显示
   - 添加了登出功能

4. 更新了App组件 ✅
   - 添加了AuthProvider
   - 确保认证功能在整个应用中可用

5. 测试状态
   - 单元测试 ✅ (2023-03-08)
   - 人工测试 ⏳ (进行中)

最后更新时间：2023年3月8日 