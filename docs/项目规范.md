# AetherFlow 项目规范

## 概述
本文档定义了AetherFlow项目的开发规范，包括代码风格、提交规范、文档规范等，旨在确保项目的一致性和可维护性。所有参与项目的开发人员都应遵循这些规范。

## 代码风格规范

### 通用规范
1. 使用UTF-8编码
2. 使用LF（Line Feed）作为行结束符
3. 文件末尾保留一个空行
4. 删除行尾多余的空格
5. 使用2个空格作为缩进（不使用Tab）
6. 最大行长度为100个字符

### JavaScript/TypeScript规范
1. 使用ESLint进行代码检查，配置文件位于项目根目录
2. 使用Prettier进行代码格式化，配置文件位于项目根目录
3. 变量命名规范：
   - 使用驼峰命名法（camelCase）
   - 常量使用全大写下划线分隔（UPPER_SNAKE_CASE）
   - 类名使用帕斯卡命名法（PascalCase）
   - 私有属性和方法以下划线开头（_privateMethod）
4. 使用ES6+语法特性：
   - 使用箭头函数代替匿名函数
   - 使用模板字符串代替字符串拼接
   - 使用解构赋值简化代码
   - 使用扩展运算符（...）代替Object.assign
5. 异步编程规范：
   - 优先使用async/await代替Promise链
   - 正确处理异常（try/catch）
6. 注释规范：
   - 使用JSDoc风格的注释
   - 复杂逻辑必须添加注释说明
   - 临时代码必须添加TODO注释

### CSS/SCSS规范
1. 使用BEM命名规范（Block__Element--Modifier）
2. 使用SCSS预处理器
3. 颜色值使用变量定义，避免硬编码
4. 媒体查询使用变量定义断点
5. 避免使用!important
6. 选择器嵌套不超过3层

### HTML规范
1. 使用语义化标签
2. 属性使用双引号
3. 自闭合标签使用斜杠结尾（如`<img />`, `<br />`）
4. 使用小写标签和属性名

### React/Vue组件规范
1. 组件文件名使用PascalCase（如`UserProfile.tsx`）
2. 每个文件只包含一个组件
3. 组件属性按字母顺序排列
4. 组件内部方法按以下顺序排列：
   - 生命周期方法
   - 事件处理方法
   - 渲染方法
5. 使用函数组件和Hooks代替类组件
6. 提取可复用逻辑到自定义Hooks

## 目录结构规范

### 前端目录结构
```
src/
├── assets/         # 静态资源（图片、字体等）
├── components/     # 通用组件
│   ├── common/     # 基础UI组件
│   └── layout/     # 布局组件
├── hooks/          # 自定义Hooks
├── pages/          # 页面组件
├── services/       # API服务
├── store/          # 状态管理
├── styles/         # 全局样式
├── types/          # TypeScript类型定义
├── utils/          # 工具函数
└── App.tsx         # 应用入口
```

### 后端目录结构
```
src/
├── config/         # 配置文件
├── controllers/    # 控制器
├── middlewares/    # 中间件
├── models/         # 数据模型
├── routes/         # 路由定义
├── services/       # 业务逻辑
├── utils/          # 工具函数
└── app.js          # 应用入口
```

## 版本控制规范

### 分支管理
1. 主分支：
   - `main`：稳定版本，用于生产环境
   - `develop`：开发版本，用于集成测试

2. 功能分支：
   - 命名格式：`feature/功能名称`
   - 从`develop`分支创建
   - 完成后合并回`develop`分支

3. 修复分支：
   - 命名格式：`bugfix/问题描述`
   - 从`develop`分支创建
   - 完成后合并回`develop`分支

4. 热修复分支：
   - 命名格式：`hotfix/问题描述`
   - 从`main`分支创建
   - 完成后同时合并回`main`和`develop`分支

5. 发布分支：
   - 命名格式：`release/版本号`
   - 从`develop`分支创建
   - 完成后同时合并回`main`和`develop`分支

### 提交规范
1. 提交信息格式：
   ```
   <类型>(<范围>): <简短描述>
   
   <详细描述>
   
   <关联的问题>
   ```

2. 类型字段：
   - `feat`：新功能
   - `fix`：Bug修复
   - `docs`：文档更新
   - `style`：代码风格调整（不影响功能）
   - `refactor`：代码重构
   - `perf`：性能优化
   - `test`：测试相关
   - `chore`：构建过程或辅助工具变动

3. 范围字段（可选）：
   - 指明修改的模块或组件

4. 示例：
   ```
   feat(prompt-library): 添加提示词卡片排序功能
   
   - 支持按时间排序
   - 支持按使用频率排序
   - 支持按收藏状态排序
   
   Closes #123
   ```

### 版本号规范
遵循语义化版本（Semantic Versioning）规范：
- 主版本号（Major）：不兼容的API变更
- 次版本号（Minor）：向下兼容的功能性新增
- 修订号（Patch）：向下兼容的问题修正

## 文档规范

### 代码注释
1. 文件头注释：
   ```javascript
   /**
    * @file 文件描述
    * @author 作者名
    * @date 创建日期
    */
   ```

2. 函数/方法注释：
   ```javascript
   /**
    * 函数描述
    * @param {类型} 参数名 - 参数描述
    * @returns {类型} 返回值描述
    * @example
    * // 使用示例
    * const result = someFunction('example');
    */
   ```

3. 类注释：
   ```javascript
   /**
    * 类描述
    * @class
    * @classdesc 详细描述
    */
   ```

### 文档文件
1. README.md：
   - 项目简介
   - 安装说明
   - 使用示例
   - 贡献指南
   - 许可证信息

2. CHANGELOG.md：
   - 版本号
   - 发布日期
   - 变更内容（新增、修改、删除）

3. API文档：
   - 使用OpenAPI/Swagger规范
   - 包含请求参数、响应格式、错误码等

## 测试规范

### 单元测试
1. 使用Jest作为测试框架
2. 测试文件命名：`*.test.js`或`*.spec.js`
3. 测试覆盖率要求：
   - 核心业务逻辑：>80%
   - 工具函数：>90%
4. 测试用例命名应清晰表达测试内容

### 端到端测试
1. 使用Cypress作为E2E测试框架
2. 覆盖关键用户流程
3. 测试环境与生产环境尽量一致

## 安全规范

### 代码安全
1. 避免使用`eval`和`Function`构造函数
2. 避免使用`innerHTML`，使用`textContent`代替
3. 使用参数化查询防止SQL注入
4. 对用户输入进行验证和转义

### 认证与授权
1. 使用HTTPS进行通信
2. 敏感信息不得硬编码在源代码中
3. 密码必须加密存储
4. 实现适当的访问控制

## 性能规范

### 前端性能
1. 使用懒加载减少初始加载时间
2. 压缩静态资源（JS、CSS、图片）
3. 使用CDN加速静态资源加载
4. 减少HTTP请求次数
5. 避免不必要的DOM操作

### 后端性能
1. 使用数据库索引优化查询
2. 实现适当的缓存策略
3. 大型计算任务异步处理
4. 定期进行性能测试和优化

## 协作规范

### 代码审查
1. 所有代码必须经过至少一人审查才能合并
2. 审查重点：
   - 代码质量和风格
   - 功能完整性
   - 测试覆盖率
   - 文档完整性
3. 审查意见应具体明确，避免模糊表述

### 问题跟踪
1. 使用GitHub Issues或JIRA跟踪问题
2. 问题描述应包含：
   - 问题概述
   - 复现步骤
   - 预期行为
   - 实际行为
   - 环境信息
3. 使用标签对问题进行分类（如`bug`, `feature`, `enhancement`）

## 发布规范

### 发布流程
1. 从`develop`分支创建`release`分支
2. 在`release`分支上进行最终测试和修复
3. 更新版本号和CHANGELOG
4. 合并到`main`分支并打标签
5. 部署到生产环境
6. 合并回`develop`分支

### 发布检查清单
1. 所有测试通过
2. 文档已更新
3. 版本号和CHANGELOG已更新
4. 性能指标符合要求
5. 安全检查通过

## 前后端集成规范

### 数据交换规范
1. 所有前后端数据交换必须使用JSON格式
2. 所有日期时间数据使用ISO 8601格式（YYYY-MM-DDTHH:mm:ss.sssZ）
3. 所有API响应必须遵循统一的响应结构：
   ```json
   {
     "success": true/false,
     "data": {}, // 成功时返回的数据
     "error": {  // 失败时返回的错误信息
       "code": "ERROR_CODE",
       "message": "错误描述"
     },
     "meta": {   // 元数据，如分页信息
       "page": 1,
       "limit": 10,
       "total": 100
     }
   }
   ```

### 前端API调用规范
1. 使用统一的API客户端模块进行所有API调用
2. 实现请求拦截器添加认证令牌
3. 实现响应拦截器统一处理错误
4. 所有API调用必须处理加载状态、成功状态和错误状态
5. 敏感操作必须有确认机制

### 状态管理规范
1. 使用统一的状态管理方案（Context API或Redux）
2. 按功能模块划分状态
3. 异步操作使用统一的模式处理
4. 避免状态冗余，减少状态同步问题

### 错误处理规范
1. 前端必须捕获并友好展示所有API错误
2. 网络错误必须有重试机制
3. 认证失效必须自动跳转到登录页面
4. 权限不足错误必须有明确提示

## 跨平台兼容性规范

### 浏览器兼容性
1. 支持的最低浏览器版本：
   - Chrome: 最新的3个主要版本
   - Firefox: 最新的3个主要版本
   - Safari: 最新的2个主要版本
   - Edge: 最新的2个主要版本
2. 使用Autoprefixer处理CSS前缀
3. 使用Babel转译JavaScript代码
4. 使用特性检测而非浏览器检测

### 响应式设计规范
1. 使用移动优先的设计方法
2. 断点设置：
   - 移动设备: < 768px
   - 平板设备: 768px - 1024px
   - 桌面设备: > 1024px
3. 使用相对单位（rem, em, %）而非固定单位（px）
4. 关键功能在所有设备上必须可用

### 插件与网页端一致性
1. 共享UI组件库确保视觉一致性
2. 共享工具函数和业务逻辑
3. 保持数据模型一致
4. 用户体验流程保持一致
5. 错误提示和帮助信息保持一致

## 性能优化规范

### 前端性能指标
1. 首次内容绘制 (FCP) < 2秒
2. 最大内容绘制 (LCP) < 2.5秒
3. 首次输入延迟 (FID) < 100毫秒
4. 累积布局偏移 (CLS) < 0.1

### 性能优化策略
1. 代码分割和懒加载
2. 图片优化（WebP格式、响应式图片）
3. 缓存策略优化
4. 预加载关键资源
5. 减少主线程阻塞
6. 优化渲染性能

### 监控与分析
1. 实现前端性能监控
2. 实现API调用性能监控
3. 定期分析性能数据
4. 建立性能回归测试 