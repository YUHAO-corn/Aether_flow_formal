# AetherFlow 前后端接口联调计划

## 概述

本文档详细说明AetherFlow项目前后端接口联调的计划和步骤。前后端接口联调是确保前端和后端能够正确通信的关键步骤，对于项目的成功至关重要。

## 联调环境准备

### 后端环境

1. **配置开发环境**
   - 确保MongoDB数据库已启动
   - 设置必要的环境变量（JWT_SECRET, MONGODB_URI等）
   - 启动后端服务器：`cd AetherFlow_backend && npm run dev`

2. **准备测试数据**
   - 创建测试用户账号
   - 预先创建一些测试用的提示词和标签
   - 准备API密钥测试数据

### 前端环境

1. **配置API基础URL**
   - 修改前端配置，指向本地后端服务
   - 确保CORS设置正确

2. **禁用Mock数据**
   - 将前端从Mock Service切换到实际API调用
   - 保留Mock数据作为参考

## 联调测试计划

### 1. 用户认证流程

| 接口 | 前端组件 | 测试用例 | 预期结果 |
|------|---------|---------|---------|
| POST `/api/v1/auth/register` | 注册表单 | 注册新用户 | 成功创建用户并返回token |
| POST `/api/v1/auth/login` | 登录表单 | 使用正确凭据登录 | 成功登录并返回token |
| GET `/api/v1/auth/me` | 用户信息页 | 获取当前用户信息 | 返回用户详细信息 |
| PATCH `/api/v1/auth/updateMe` | 用户设置页 | 更新用户信息 | 成功更新并返回更新后的信息 |

### 2. 提示词管理流程

| 接口 | 前端组件 | 测试用例 | 预期结果 |
|------|---------|---------|---------|
| POST `/api/v1/prompts` | 创建提示词表单 | 创建新提示词 | 成功创建并返回提示词信息 |
| GET `/api/v1/prompts` | 提示词列表页 | 获取提示词列表 | 返回分页的提示词列表 |
| GET `/api/v1/prompts/:id` | 提示词详情页 | 获取单个提示词 | 返回提示词详细信息 |
| PATCH `/api/v1/prompts/:id` | 编辑提示词表单 | 更新提示词 | 成功更新并返回更新后的信息 |
| DELETE `/api/v1/prompts/:id` | 提示词列表页 | 删除提示词 | 成功删除提示词 |
| POST `/api/v1/prompts/batch` | 批量操作组件 | 批量获取提示词 | 返回指定ID的提示词列表 |
| GET `/api/v1/prompts/search` | 搜索组件 | 搜索提示词 | 返回匹配的提示词列表 |

### 3. 标签管理流程

| 接口 | 前端组件 | 测试用例 | 预期结果 |
|------|---------|---------|---------|
| POST `/api/v1/tags` | 创建标签表单 | 创建新标签 | 成功创建并返回标签信息 |
| GET `/api/v1/tags` | 标签列表页 | 获取标签列表 | 返回标签列表 |
| GET `/api/v1/tags/:id` | 标签详情页 | 获取单个标签 | 返回标签详细信息 |
| PATCH `/api/v1/tags/:id` | 编辑标签表单 | 更新标签 | 成功更新并返回更新后的信息 |
| DELETE `/api/v1/tags/:id` | 标签列表页 | 删除标签 | 成功删除标签 |
| GET `/api/v1/tags/:id/prompts` | 标签详情页 | 获取标签关联的提示词 | 返回关联的提示词列表 |

### 4. 会话管理流程

| 接口 | 前端组件 | 测试用例 | 预期结果 |
|------|---------|---------|---------|
| POST `/api/v1/conversations` | 创建会话组件 | 创建新会话 | 成功创建并返回会话信息 |
| GET `/api/v1/conversations` | 会话列表页 | 获取会话列表 | 返回分页的会话列表 |
| GET `/api/v1/conversations/:id` | 会话详情页 | 获取单个会话 | 返回会话详细信息 |
| PATCH `/api/v1/conversations/:id` | 编辑会话组件 | 更新会话 | 成功更新并返回更新后的信息 |
| DELETE `/api/v1/conversations/:id` | 会话列表页 | 删除会话 | 成功删除会话 |
| POST `/api/v1/conversations/:id/messages` | 会话详情页 | 添加消息到会话 | 成功添加消息并返回更新后的会话 |

### 5. 提示词优化流程

| 接口 | 前端组件 | 测试用例 | 预期结果 |
|------|---------|---------|---------|
| POST `/api/v1/optimize` | 提示词优化页 | 优化提示词 | 返回优化后的提示词 |
| GET `/api/v1/optimize/history` | 优化历史页 | 获取优化历史 | 返回分页的优化历史列表 |
| GET `/api/v1/optimize/history/:id` | 优化详情页 | 获取单个优化记录 | 返回优化记录详细信息 |
| POST `/api/v1/optimize/history/:id/rate` | 优化详情页 | 评价优化结果 | 成功保存评价并返回确认 |

### 6. API密钥管理流程

| 接口 | 前端组件 | 测试用例 | 预期结果 |
|------|---------|---------|---------|
| POST `/api/v1/api-keys` | 添加API密钥表单 | 添加API密钥 | 成功添加并返回密钥信息 |
| GET `/api/v1/api-keys` | API密钥列表页 | 获取API密钥列表 | 返回密钥列表 |
| DELETE `/api/v1/api-keys/:id` | API密钥列表页 | 删除API密钥 | 成功删除密钥 |

### 7. 活动日志管理流程

| 接口 | 前端组件 | 测试用例 | 预期结果 |
|------|---------|---------|---------|
| GET `/api/v1/activities` | 活动日志列表页 | 获取活动日志列表 | 返回分页的活动日志列表 |
| GET `/api/v1/activities/:id` | 活动日志详情页 | 获取单个活动日志 | 返回活动日志详细信息 |
| GET `/api/v1/activities/stats` | 活动统计页 | 获取活动统计数据 | 返回活动统计信息 |
| DELETE `/api/v1/activities` | 活动日志列表页 | 清除活动日志 | 成功清除指定条件的活动日志 |

## 联调方法

### 1. 接口测试工具

使用Postman或类似工具先测试后端API，确保API正常工作：

```bash
# 示例：测试登录接口
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

### 2. 前端集成测试

1. **逐个功能模块测试**
   - 从用户认证开始，确保登录/注册正常
   - 依次测试提示词管理、标签管理等功能

2. **端到端测试**
   - 测试完整的用户流程，如：注册->登录->创建提示词->添加标签->优化提示词

### 3. 问题记录与修复

使用以下表格记录联调过程中发现的问题：

| 问题ID | 接口 | 问题描述 | 解决方案 | 状态 |
|-------|------|---------|---------|------|
| 001 | `/api/v1/auth/login` | 示例：返回格式与前端期望不符 | 调整后端响应格式 | 已解决 |

## 联调时间安排

| 阶段 | 时间 | 负责人 |
|------|------|-------|
| 环境准备 | 1天 | 前端开发 & 后端开发 |
| 用户认证流程联调 | 1天 | 前端开发 & 后端开发 |
| 提示词管理流程联调 | 1天 | 前端开发 & 后端开发 |
| 标签管理流程联调 | 1天 | 前端开发 & 后端开发 |
| 会话管理流程联调 | 1天 | 前端开发 & 后端开发 |
| 提示词优化流程联调 | 1天 | 前端开发 & 后端开发 |
| API密钥管理流程联调 | 0.5天 | 前端开发 & 后端开发 |
| 活动日志管理流程联调 | 0.5天 | 前端开发 & 后端开发 |
| 问题修复与重测 | 2天 | 前端开发 & 后端开发 |

## 联调成功标准

1. 所有接口能够正确响应前端请求
2. 数据格式与前端期望一致
3. 所有业务流程能够正常完成
4. 无明显的性能问题
5. 错误处理机制正常工作

## 联调后续工作

1. **性能优化**
   - 识别并优化慢查询
   - 添加适当的缓存机制

2. **安全加固**
   - 确保所有敏感接口都有适当的权限控制
   - 检查输入验证和输出过滤

3. **文档更新**
   - 更新API文档，确保与实际实现一致
   - 记录联调过程中发现的问题和解决方案 